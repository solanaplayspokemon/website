<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pump Fun Game and Market Cap Table</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        .embed-container {
            width: 100%;
            height: 600px;
            margin-bottom: 20px;
        }
        .instructions {
            background-color: #f0f0f0;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1><a href="https://pump.fun/HgXEhe9DXwiTZ5KtuDzJeQLWGHm3z71obXbAushmUGvS">CLICK HERE TO PLAY</a></h1>

    <div class="instructions">
        <h2>Instructions:</h2>
        <ol>
            <li>Connect Wallet.</li>
            <li>Join Livestream if not joined already.</li>
            <li>Post a reply message with one of the commands to play.</li>
        </ol>
        <p>Commands: up, down, left, right, b, a, select, start</p>
    </div>

    <div class="embed-container">
        <!-- Embedded website content goes here -->
        <!-- You may need to replace this with an actual embed code or iframe -->
    </div>

    <h2>Market Cap Table</h2>
    <table id="marketCapTable" border="1">
        <tr>
            <th>Number</th>
            <th>Image</th>
            <th>Market Cap</th>
            <th>Link</th>
        </tr>
    </table>

    <script>
        // Function to create table rows
        function createTableRows() {
            const table = document.getElementById('marketCapTable');
            for (let i = 1; i <= 151; i++) {
                const row = table.insertRow(-1);
                const paddedNumber = i.toString().padStart(4, '0');
                
                row.insertCell(0).textContent = paddedNumber;
                row.insertCell(1).innerHTML = `<img src="${paddedNumber}.png" alt="${paddedNumber}">`;
                row.insertCell(2).textContent = 'Waiting for data...';
                row.insertCell(3).textContent = 'Link placeholder';
            }
        }

        // Create table rows
        createTableRows();

        // Connect to WebSocket
        const socket = io('wss://frontend-api.pump.fun', {
            transports: ['websocket'],
            query: {
                EIO: 4
            }
        });

        // Listen for connect event
        socket.on('connect', () => {
            console.log('Connected to WebSocket');
        });

        // Listen for tradeCreated messages
        socket.on('message', (message) => {
            try {
                const data = JSON.parse(message);
                if (data.event === 'tradeCreated' && 
                    data.data.id === '5sDn61tjfV4GEhm9kPMyukrKZkzm3WkipM3CKJnAmT4BjLUMd5A9J8sJ7QvrPuLoR5pAYGjUDMPcnbwHW9AisL95') {
                    updateMarketCap(data.data.usd_market_cap);
                }
            } catch (error) {
                console.error('Error parsing message:', error);
            }
        });

        // Function to update market cap in the table
        function updateMarketCap(marketCap) {
            const table = document.getElementById('marketCapTable');
            const rows = table.getElementsByTagName('tr');
            
            // Start from index 1 to skip the header row
            for (let i = 1; i < rows.length; i++) {
                const cell = rows[i].cells[2];
                cell.textContent = `$${marketCap.toFixed(2)}`;
            }
        }

        // Error handling
        socket.on('error', (error) => {
            console.error('WebSocket error:', error);
        });

        socket.on('disconnect', (reason) => {
            console.log('Disconnected from WebSocket:', reason);
        });
    </script>
</body>
</html>